### 实际配置文件获取
实际配置文件包含在"包含密码的配置文件.zip"，解压需要密码  

将解压后的yml配置文件覆盖"\src\main\resources"目录的同名配置文件

> 打包部署前可以：
> 1. 更改代码：SecurityConfig的debug=true属性修改，可以看到更多日志
> 2. profile使用prod，默认prod环境

### 部署步骤
#### 测试环境
```
# 构建jar
mvn clean package
# 进入target目录
cd target/
# 使用sftp上传的服务器
sudo sftp -P 10022 root@192.168.99.77:/root/testoauth2/
# 上传
put tdf-oauth-server-2.3.9.1.jar
# 推出sftp
exit
```


```
# 运行
#!/bin/bash
nohup java -jar tdf-oauth-server-2.3.9.1.jar --spring.profiles.active=prod --server.port=9999 &  > log.file 2>&1 &

# 停止
#!/bin/bash
PID=$(ps -ef | grep "tdf-oauth-server-2.3.9.1.jar --spring.profiles.active=prod" | grep -v grep | awk '{ print $2 }')
if [ -z "$PID" ]
then
    echo Application is already stopped
else
    echo kill $PID
    kill $PID
fi

```
#### 生产环境
```
# 构建jar
mvn clean package
# 进入target目录
cd target/
# 使用sftp上传的服务器
sudo sftp -P 10022 root@192.168.99.77:/root/oauth2/181
# 上传
put tdf-oauth-server-2.3.9.1.jar
# 推出sftp
exit
```


#### nginx
1. 关于nginx支持https参考：[Centos 7安装nginx并配置https](https://blog.csdn.net/xu12387/article/details/86517817)
1. https证书在: `doc/包含Https证书.zip` 此压缩文件需要密码
1. 脚本
    192.168.99.77
    1. /usr/local/nginx
    1. 启动 ./sbin/nginx 
    1. /usr/local/nginx/sbin/nginx -s reload
    1. /usr/local/nginx/sbin/nginx -s stop


### 集群部署
tdf-oauth-server目前没有原生支持集群部署。可以使用nginx代理的方式，
将统一ip的用户路由到特定的tdf-oauth-server示例的方式。目前生产环境使用的nginx主备模式部署

 备份服务在192.168.99.76服务器的/root/oauth2目录下